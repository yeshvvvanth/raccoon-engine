#include"Hydrogen.h"


#include"../utils/loader.h"

bool running=true;
Window* window;

void render();
void cleanup();
////////////////////////////////////////
int main(int argc,char* argv[]){

    SDL_Init(SDL_INIT_VIDEO);
    window=new Window("Test app",SDL_WINDOWPOS_CENTERED,0,960,540,SDL_WINDOW_OPENGL|SDL_WINDOW_RESIZABLE);
    glewExperimental=GL_TRUE;
    glewInit();

    loadShaders();
    shaders[0]->use();
    loadData();
    //#include"../set_matrices.hpp"

    ///////GAME LOOP//////////
    #ifdef EMSCRIPTEN
	emscripten_set_main_loop(render,0,1);
    #else
	while(running){render();}
    #endif
    //////////////////////////
    cleanup();
	
    return 0;
}

SDL_Event event;

void render(){

    while(SDL_PollEvent(&event)){
	  if(event.type==SDL_QUIT){running=false;break;}
	  }
    glClearColor(0.6f,0.3f,0.3f,1.0f);
    glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);
    meshes[0]->render();

    SDL_GL_SwapWindow(window->sdl_window);
}

void cleanup(){
    for(Texture* tp:textures)delete tp;
    for(Mesh* m:meshes)delete m;
    for(Shader* sh:shaders)delete sh;

    delete window;
    SDL_Quit();

}


